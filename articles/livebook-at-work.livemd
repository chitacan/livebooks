# Livebook at Work

```elixir
Mix.install([
  {:kino, "~> 0.6.2"},
  {:kino_vega_lite, "~> 0.1.2"}
])
```

## Introduction

ì—…ë¬´ì—ì„œ Livebook ì„ ì‚¬ìš©í•  ë•Œ ì•Œì•„ë‘ë©´ ì¢‹ì€ íŒë“¤ì„ ì†Œê°œí•©ë‹ˆë‹¤.

## livemd on github

[nallwhy](https://github.com/nallwhy) ë‹˜ì˜ [PR ë•ë¶„ì—](https://github.com/github/linguist/pull/5672) github ì—ì„œ ë Œë”ë§ ëœ `livemd` íŒŒì¼ì„ ë³¼ ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

## Attached node í™œìš©í•˜ê¸°

Livebook ì€ ê¸°ë³¸ì ìœ¼ë¡œ Elixir standalone ëª¨ë“œë¡œ ë™ì‘í•˜ëŠ”ë°, Runtime Settings ë©”ë‰´ì—ì„œ ì´ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì—¬ê¸°ì„œ Attached node ë¥¼ ì„ íƒí•˜ë©´, Livebook ì˜ ì„¸ì…˜ì´ ì„¤ì •ëœ ë…¸ë“œì˜ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ë™ì‘í•˜ë„ë¡ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<img width="500" src="https://user-images.githubusercontent.com/286950/179925283-b25a5700-e0ec-4c71-9cb4-3002510bccd4.png" />

Attached node ì—ì„œëŠ” iex ì²˜ëŸ¼ ë…¸ë“œì— ë¡œë“œëœ ëª¨ë“  ëª¨ë“ˆì„ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, ìƒˆë¡œìš´ ëª¨ë“ˆì„ ì„ ì–¸í•˜ê³  í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•©ë‹ˆë‹¤. (ì•„ì‰½ê²Œë„ [IEx.Helpers](https://hexdocs.pm/iex/IEx.Helpers.html) ëŠ” ì‚¬ìš©ì´ ë¶ˆê°€ëŠ¥í•¨ ğŸ˜“) ë‹¤ë§Œ, Attached node ì—ì„œ ì„ ì–¸ëœ ëª¨ë“ˆì€ ì—°ê²°ì´ í•´ì œëœ ì´í›„ì—ë„ ë…¸ë“œì— ë‚¨ì•„ìˆê¸° ë•Œë¬¸ì— ì£¼ì˜í•´ì„œ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

[momenti](https://github.com/corp-momenti/) ì—ì„œëŠ” Attached node ì„¤ì •ì´ ê°€ëŠ¥í•œ Livebook ì»¨í…Œì´ë„ˆë¥¼  ìš´ì˜í™˜ê²½ì— ë°°í¬í•´ë‘ê³ , Livebook ì„ ì‚¬ìš©í•´ ë‹¤ì–‘í•œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤.

## Kino í™œìš©í•˜ê¸°

Kino.Frame ìœ¼ë¡œ ì…€ì˜ ì¶œë ¥ê°’ì„ ì»¨íŠ¸ë¡¤ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì…€ì˜ ì¶œë ¥ê°’ì´ ì—¬ëŸ¬ê°œì¸ ê²½ìš° ìœ ìš©í•©ë‹ˆë‹¤.

```elixir
frame = Kino.Frame.new() |> Kino.render()

Kino.Frame.append(frame, "first output")
Kino.Frame.append(frame, "second output")
Kino.Frame.append(frame, "third output")
Kino.Frame.append(frame, "4th output")

Kino.nothing()
```

```elixir
Kino.Markdown.new("""
**Markdown** ëª¨ë“ˆì„ ì‚¬ìš©í•´ ë§ˆí¬ë‹¤ìš´ ë¬¸ë²•ì˜ í…ìŠ¤íŠ¸ë¥¼ ë Œë”ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
""")
```

ì…€ì—ì„œ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤í–‰í•œë‹¤ë©´, Kino.start_child ë¥¼ ì‚¬ìš©í•´ì„œ ì‹œì‘í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤. ì…€ì´ ë‹¤ì‹œ í‰ê°€ë˜ì–´ ìƒˆë¡œìš´ í”„ë¡œì„¸ìŠ¤ê°€ ìƒì„±ë  ë•Œ, ì´ì „ì— ì‹¤í–‰ëœ í”„ë¡œì„¸ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ì •ë¦¬í•´ì¤ë‹ˆë‹¤.

```elixir
{:ok, agent} = Agent.start(fn -> nil end)
```

```elixir
:c.pid(0, 263, 0) |> Process.alive?()
```

```elixir
Kino.start_child(%{id: :agent, start: {Agent, :start, [fn -> nil end]}})
```

```elixir
:c.pid(0, 277, 0) |> Process.alive?()
```

Kino.DataTable ëŠ” ë³µì¡í•œ ë°ì´í„°ë¥¼ í…Œì´ë¸”ë¡œ ê¹”ë”í•˜ê²Œ ë³€í™˜í•´ ì¤ë‹ˆë‹¤.

```elixir
Application.started_applications()
|> Enum.map(fn {name, description, version} ->
  %{name: name, description: description, version: version}
end)
|> Kino.DataTable.new()
```

Kino.Process ë¡œ ì–´í”Œë¦¬ì¼€ì´ì…˜ íŠ¸ë¦¬ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```elixir
Kino.Process.app_tree(:logger, direction: :left_right)
```

Kino.JS, Kino.JS.Live ë¥¼ ì‚¬ìš©í•´ javascript ë¡œ ë Œë”ë§ë˜ëŠ” Kino ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```elixir
defmodule Hello do
  use Kino.JS

  def new() do
    Kino.JS.new(__MODULE__, nil)
  end

  asset "main.js" do
    """
    export async function init(ctx) {
      const div = document.createElement('div');
      div.innerText = "hello";
      ctx.root.appendChild(div);
    }
    """
  end
end

Hello.new()
```

```elixir
defmodule HelloFrom do
  use Kino.JS
  use Kino.JS.Live

  def new() do
    Kino.JS.Live.new(__MODULE__, nil)
  end

  def handle_connect(context) do
    {:ok, nil, context}
  end

  def handle_event("from_js", _, context) do
    IO.inspect("hello from js")
    {:noreply, context}
  end

  asset "main.js" do
    """
    export async function init(ctx) {
      const button = document.createElement('button');
      button.innerText = "hello";
      button.addEventListener("click", () => ctx.pushEvent("from_js", []))
      ctx.root.appendChild(button);
    }
    """
  end
end

HelloFrom.new()
```

VegaLite ëª¨ë“ˆì„ ì‚¬ìš©í•´ Livebook ì—ì„œ ë§Œë“¤ì–´ë‚¸ ë°ì´í„°ë¥¼ [vega-lite](https://vega.github.io/vega-lite/) ê·¸ë˜í”„ë¡œ í‘œí˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```elixir
alias VegaLite, as: Vl

Vl.new(width: 600, height: 400)
|> Vl.data_from_url("https://vega.github.io/editor/data/penguins.json")
|> Vl.mark(:point)
|> Vl.encode_field(:x, "Flipper Length (mm)", type: :quantitative, scale: [zero: false])
|> Vl.encode_field(:y, "Body Mass (g)", type: :quantitative, scale: [zero: false])
|> Vl.encode_field(:color, "Species", type: :nominal)
```

vega-lite ì˜ json ë¬¸ë²•ì€ ì–¸ëœ» ë³´ê¸°ì—ëŠ” ê½¤ ì‹¬í”Œí•˜ì§€ë§Œ, (ë§¤ìš°ë§¤ìš°) ê´´ë„í•œ ë¬¸ë²•ì„ ê°€ì§€ê³  ìˆê³  í™•ì¥í•˜ê¸°ë„  ì‰½ì§€ì•Šì€ êµ¬ì¡°ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.
Kino.JS ë¥¼ ì‚¬ìš©í•´ ë‹¤ë¥¸ ê·¸ë˜í”„ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì˜ì¡´ì„±ìœ¼ë¡œ ê°€ì ¸ì™€ Livebook ì— ë Œë”ë§ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```elixir
defmodule Plot do
  use Kino.JS

  def new(url) do
    Kino.JS.new(__MODULE__, url)
  end

  asset "main.js" do
    """
    import * as Plot from "https://cdn.skypack.dev/@observablehq/plot";
    import {json} from "https://cdn.skypack.dev/d3-fetch";

    export async function init(ctx, url) {
      const data = await json(url);
      const plot = Plot.plot({
        grid: true,
        height: 400,
        color: {
          legend: true
        },
        marks: [
          Plot.dot(data, {
            x: "Flipper Length (mm)",
            y: "Body Mass (g)",
            stroke: "Species"
          })
        ]
      });
      ctx.root.appendChild(plot);
    }
    """
  end
end

Plot.new("https://vega.github.io/editor/data/penguins.json")
```

## Examples

* [Membrane and Kino](./membrane-and-kino.livemd)
* [Extract video frames with kino](./extract-video-frames-with-kino.livemd)
